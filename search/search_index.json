{"docs":[{"location":"/paradox.json","text":"","title":""},{"location":"/index.html","text":"Guide de montage d‚Äôun syst√®me d‚Äôoptimisation de charge en continu pour v√©hicules Tesla","title":""},{"location":"/introduction.html","text":"","title":"Introduction ¬∑"},{"location":"/introduction.html#introduction","text":"Pour les heureux d√©tenteurs de panneaux photovolta√Øques et d‚Äôune tarification √©lectrique variable, il est possible de se fabriquer soi-m√™me un syst√®me d‚Äôoptimisation de la charge pour minimiser les co√ªts en √©lectricit√© et maximiser l‚Äôutilisation de la production solaire.","title":"Introduction"},{"location":"/introduction.html#principe","text":"Le syst√®me mesure en continu l‚Äôinjection de courant solaire et la consommation domestique. Il est configur√© avec les horaires de tarification diff√©renci√©e (double tarif). Il est capable de localiser, d√©marrer et arr√™ter la charge de la Tesla, ainsi que de moduler l‚Äôamp√©rage (la quantit√© de courant envoy√© dans la prise). Gr√¢ce √† ces √©l√©ments et √† des algorithmes simples tels qu‚Äôune moyenne glissante le syst√®me ajuste la charge √† intervalles r√©guliers pour minimiser les frais et maximimiser l‚Äôauto-consommation.","title":"Principe"},{"location":"/introduction.html#elements-de-base","text":"Le syst√®me repose sur trois piliers:\nUn bo√Ætier central domotique (Home Assistant) L‚Äôenvoi de commandes √† la voiture via l‚ÄôAPI Tesla Des compteurs d‚Äô√©lectricit√© connect√©s (Wifi) qui mesurent en permanence la consommation et l‚Äôinjection de courant solaire.","title":"Elements de base"},{"location":"/introduction.html#tableaux-de-bord","text":"Home Assistant permet d‚Äô√©laborer des tableaux de bords disponibles sur un browser ou via une application. En voici quelques examples:\nDiagramme des flux de courant: les panneaux solaires produisent environ 3KW, dont 2.2KW peuvent √™tre envoy√©s dans la Tesla (je charge au 220V) et le reste est absorb√© par la consommation domestique. Le r√©seau n‚Äôest presque pas solicit√©.\nGraphe repr√©sentant l‚Äô√©volution de l‚Äôamp√©rage de charge. En bleu fonc√©, la valeur cible instantan√©e telle que calcul√©e par le syst√®me en continu: la valeur varie de fa√ßon importante suivant l‚Äô√©volution de la couverture nuageuse et la consommation domestique (pompe √† chaleur). En rose, la valeur cible telle que calcul√©e par le syst√®me avec une ‚Äúmoyenne glissante‚Äù. En bleu clair, la charge effective telle que mesur√©e par le compteur √©lectrique sur la prise dans le garage. Sa valeur varie par paliers, du fait que la mise √† jour de l‚Äôamp√©rage a lieu toutes les 3 minutes (d√©cision arbitraire pour √©viter d‚Äôenvoyer trop de commandes √† l‚ÄôAPI). La charge s‚Äôarr√™te vers 10:30 quand la batterie arrive au pourcentage de charge desir√©. Vous l‚Äôaurez compris, ma Tesla s‚Äôappelle Ferrite üòÄ\nReverse-engineering Tesla ne publie pas son API (acronyme pour ‚ÄúApplication Programming Interface‚Äù), elle a donc √©t√© obtenue par reverse-engineering, c‚Äôest-√†-dire en analysant le traffic internet de l‚Äôapplication Tesla. Malgr√© le fait que cela ne soit pas officiel, l‚ÄôAPI n‚Äô√©volue pas brusquement, car Tesla doit maintenir la compatibilit√© avec une vari√©t√© de versions de son app. Le service TeslaFi qui permet de suivre l‚Äôutilisation de sa Tesla existe depuis 2016 et utilise cette m√™me API. En 2020, Tesla a am√©lior√© son syst√®me d‚Äôauthentification pour permettre d‚Äôutilisation de deux-facteurs et la communaut√© s‚Äôest aussi adapt√©e.","title":"Tableaux de bord"},{"location":"/materiel.html","text":"","title":"Mat√©riel ¬∑"},{"location":"/materiel.html#mat√©riel","text":"Voici la liste du mat√©riel n√©cessaire √† la r√©alisation de ce montage.","title":"Mat√©riel"},{"location":"/materiel.html#bo√Ætier-domotique","text":"Nous suivons ici la recommendation de Home Assistant et nous nous √©quipons d‚Äôun Rasberry 4. Il est important qu‚Äôil soit aliment√© correctement, le plus simple est d‚Äôacheter un kit qui comprend un bo√Ætier et le chargeur. Il faut aussi id√©alement le relier au r√©seau √† l‚Äôaide un cable RJ45, √† privil√©gier sur le Wifi pour avoir une connection la plus stable possible. Dans ce guide, nous installons le syst√®me d‚Äôexploitation Home Assistant sur le Rasberry et celui-ci est donc d√©di√© enti√®rement √† la gestion domotique. A moins que le kit ne comprenne d√©j√† une carte MicroSD de capacit√© suffisante, nous rajoutons l‚Äôachat d‚Äôune carte de 32GB. Il faut aussi un moyen d‚Äô√©crire sur la carte depuis votre ordinateur, s‚Äôil n‚Äôen est pas √©quipp√© un lecteur de carte USB externe fait parfaitement l‚Äôaffaire.\nBo√Ætier Rasperry Pi 4\nLecteur de carte MicroSD\nMa configuration:\nOKDO Rasberry Pi 4 Basic kit (80CHF chez Microspot) SANDISK MicroSD MicroSDHC Ultra 32GB (12.50CHF) HAMA Lecteur de cartes USB 3.0 type A (10CHF)","title":"Bo√Ætier domotique"},{"location":"/materiel.html#compteurs-wifi","text":"Pour les compteurs d‚Äô√©lectricit√© nous avons choisi des compteurs Wifi Shelly. Nous avons besoin de deux unit√©s:\nCompteur principal tri-phas√© Shelly3EM (disponible en vente directe ou via online shops, 110CHF environ) Compteur annexe pour la production solaire ShellyEM (60CHF environ). Diff√©rents packs existent, le minimum est le pack de base avec une pince √† induction de 50A, suffisant pour mesurer la production solaire avec un onduleur mono-phas√©. Si vous souhaitez mesurer le courant effectivement envoy√© dans la prise via le disjoncteur correspondant (chez moi c‚Äôest le disjoncteur du garage), alors vous pouvez prendre un pack avec deux pinces. Cables √©lectriques, 2 m√®tres suffisent, prendre du 2.5 mm de section (16A) de chaque couleur plus le neutre (brun, noir, gris, bleu)\nAvertissement Ce montage utilise des compteurs √©lectriques qui doivent √™tre install√©s sur le panneau central. Il est recommand√© de faire appel au sp√©cialiste pour l‚Äôinstallation de ceux-ci. Le guide d√©cline toute responsabilit√© en cas d‚Äôerreur d‚Äôinstallation.\nAlternative: API solaire Si l‚Äôinstallation de compteurs n‚Äôest pas envisageable, ou vous avez d√©j√† une installation existante, il est possible de r√©cup√©rer les donn√©es solaires au moyen d‚Äôune int√©gration Home Assistant. Par exemple, les syst√®mes SolarEdge permettent de r√©cup√©rer la production solaire (et la consommation, si votre installation est √©quip√©e de ce module). La fr√©quence de mise √† jour des valeurs est toutefois limit√©e et donc la pr√©cision sera moindre que celle du compteur connect√©. Il est √©galement possible de se baser uniquement sur la valeur de production solaire et d‚Äôestimer votre consommation domestique moyenne, mais bien entendu la pr√©cision de l‚Äôoptimisation en p√¢tira.\nNote Remarquez que cette liste ne constitue qu‚Äôune recommendation, il est possible d‚Äôutiliser d‚Äôautres marques tant que l‚Äôint√©gration avec Home Assistant existe et fonctionne.","title":"Compteurs Wifi"},{"location":"/ha.html","text":"","title":"Installation de Home-Assistant ¬∑"},{"location":"/ha.html#installation-de-home-assistant","text":"L‚Äôinstallation de Home-Assistant est tr√®s facile, il suffit de suivre les √©tapes d√©crites ici.","title":"Installation de Home-Assistant"},{"location":"/ha.html#flash","text":"Il s‚Äôagit en r√©sum√© d‚Äôins√©rer votre carte MicroSD dans le lecteur de carte sur votre PC ou votre Mac, de t√©l√©charger le programme Balena Etcher et de flash l‚Äôimage de Home Assistant dessus juste en saisissant l‚ÄôURL de l‚Äôimage disque correspondante https://github.com/home-assistant/operating-system/releases/download/6.6/haos_rpi4-64-6.6.img.xz (adapt√©e pour le mat√©riel sugg√©r√©).","title":"Flash"},{"location":"/ha.html#d√©marage","text":"Ins√©rez ensuite la carte MicroSD dans votre Rasberry, branchez-le au r√©seau via le cable ethernet, branchez-le au secteur via l‚Äôalimentation adapt√©e et vous devriez pouvoir vous connecter apr√®s quelques minutes sur http://homeassistant.local:8123/\nNote Ce qui est flash sur la carte est le syst√®me d‚Äôexploitation Home Assistant ( HAOS ), qui est un Linux d√©di√© pour faire tourner le programme Home Assistant ( HA ) lui-m√™me. Il est bien entendu possible de faire tourner HA sur un autre OS, nous proposons ici la proc√©dure d‚Äôinstallation la plus facile.","title":"D√©marage"},{"location":"/ha.html#hacs","text":"Pour l‚Äôinstallation de l‚Äôint√©gration Tesla, nous avons besoin du module HACS (Community Store). Cette √©tape est peut-√™tre la plus d√©licate au niveau logiciel car il faut utiliser SSH et la ligne de commande. Il suffit toutefois de suivre les instructions ici.\nEn r√©sum√©, la proc√©dure est la suivante:\ninstaller un add-on SSH: une fois install√©, cliquer sur le bouton pour acc√©der √† la console entrer wget -O - https://get.hacs.xyz | bash - dans la console pour lancer d‚Äôinstallation de HACS red√©marrez √©ventuellement Home Assistant si n√©cessaire ( Configuration -> Server Controls -> Server Management -> Restart ) vous devriez voir appara√Ætre l‚Äôonglet HACS dans le menu √† gauche:","title":"HACS"},{"location":"/tesla-ha.html","text":"","title":"Tesla custom integration ¬∑"},{"location":"/tesla-ha.html#tesla-custom-integration","text":"Une fois HACS install√©, vous pouvez ajouter l‚Äôint√©gration Tesla en suivant les explications disponibles ici","title":"Tesla custom integration"},{"location":"/tesla-ha.html#ajout-du-dans-hacs-et-configuration","text":"dans HACS, acc√©der √† l‚Äôonglet Integrations et cliquer sur Explore & Add Repositories chercher Tesla et choisir https://github.com/alandtse/tesla comme repository red√©marrer Home Assistant ( Configuration -> Server Controls -> Server Management -> Restart ) l‚Äôint√©gration Tesla est maintenant disponible dans Configuration -> Integrations cliquer sur Add Integration en bas √† droite et choisir Tesla Custom Integration","title":"Ajout du repository dans HACS et configuration"},{"location":"/tesla-ha.html#g√©neration-dun-tesla","text":"Pour que l‚Äôint√©gration Tesla puisse s‚Äôauthentifier √† votre compte, il lui faut un token (jeton). Pour g√©n√©rer ce jeton, le plus simple est d‚Äôutiliser une application √† t√©l√©charger sur le smartphone, pour IOS ou pour Android.\nIl suffit de copier le Refresh Token pr√©sent√© et de le rentrer dans le dialogue de l‚Äôint√©gration, la connection devrait se faire ensuite toute seule. La voiture est ajout√©e en tant que device ainsi que ses diverses entities, pr√™ts √† l‚Äôenvoi de commandes et l‚Äôint√©gration sur tableaux de bord.","title":"G√©neration d‚Äôun token Tesla"},{"location":"/compteurs.html","text":"","title":"Compteurs √©lectriques Wifi ¬∑"},{"location":"/compteurs.html#compteurs-√©lectriques-wifi","text":"Pour suivre en continu la consommation et production de courant, nous installons un compteur g√©n√©ral trois phases et un compteur monophase, respectivement.\nAvertissement Bien que ce guide explique le montage attendu sur le panneau √©lectrique central, il est recommand√© de faire appel au sp√©cialiste pour l‚Äôinstallation. Le guide d√©cline bien s√ªr toute responsabilit√© en cas d‚Äôerreur ou d‚Äôaccident √† la suite ou lors de l‚Äôinstallation.","title":"Compteurs √©lectriques Wifi"},{"location":"/compteurs.html#compteur-triphas√©","text":"Vue d‚Äôensemble de l‚Äôinstallation\nCe compteur se branche directement sur les trois phases, au point d‚Äôentr√©e du r√©seau. La mesure se fait gr√¢ce √† des pinces √† induction, qu‚Äôil suffit de positionner autour du cable (dans la direction indiqu√©e pour que les valeurs soient du bon signe). L‚Äôalimentation du bo√Ætier lui-m√™me se r√©alise aussi sur chaque phase ainsi qu‚Äôau neutre. Pour avoir une mesure correcte, il faut simplement faire attention √† respecter le bon ordre et brancher la pince sur le cable de couleur correspondant √† celui de l‚Äôalimentation.\nShelly 3EM install√©: on aper√ßoit la pince √† induction en place autour de chaque phase (noir, brun, gris)\nVoici les √©tapes:\nChoisir un disjoncteur pour saisir l‚Äôalimentation, il n‚Äôest pas vraiment important lequel, mais il faudra couper l‚Äôalimentation. Couper l‚Äôalimentation de toute la rang√©e ou se situe le disjoncteur. Bien v√©rifier que le courant est √©teint avec un multim√®tre, en prenant le voltage AC sur chaque phase o√π il est pr√©vu de brancher le cable. Couper le courant sur la rang√©e ainsi que sur le disjoncteur lui-m√™me (note: sur la photo, le courant est branch√©) D√©visser le connecteur sous le disjoncteur de telle mani√®re √† pouvoir rajouter le cable d‚Äôalimentation √† l‚Äôint√©rieur. Brancher l‚Äôautre extr√©mit√© sur le Shelly. Faire de m√™me pour chaque phase (brun, noir, gris), ainsi que pour le neutre (bleu). Branchement des cables d‚Äôalimentation du Shelly 3EM. On distingue de gauche √† droite la prise sur le neutre (bleu) et sur chaque phase (brun, noir, gris). (note: sur la photo, le courant est branch√©, il faut √©videmment le d√©brancher pour l‚Äôinstallation) Installer le Shelly sur le rail, brancher les pinces et les installer sur le cable correspondant, en prenant garde √† respecter la direction du courant. Le manuel d‚Äôutilisation recommende de brancher la pince avant sur le Shelly. Il n‚Äôest pas n√©cessaire de couper le courant g√©n√©ral pour positionner les pinces, mais pr√™ter attention ou l‚Äôon met les doigts! Pince √† induction en place Une fois le Shelly branch√©, il cr√©e son propre Wifi pour permettre de le configurer avec l‚Äôapp Shelly. Se tenir pr√®s avec le smartphone et suivre la proc√©dure dans l‚Äôapp afin le rajouter au Wifi principal. Il faut parfois plusieurs tentatives, ne pas se d√©courager. Une fois le Wifi principal rejoint, la connection est stable. Se connecter sur Home Assistant Configuration -> Server Controls. Il devrait avoir d√©tect√© automatiquement la pr√©sence du Shelly 3EM sur le r√©seau. Rajouter l‚Äôint√©gration et v√©rifier que les valeurs sont correctes.","title":"Compteur triphas√©"},{"location":"/compteurs.html#compteur-monophas√©","text":"Compteur shelly 2EM, qui permet le raccord de deux pinces. L‚Äôid√©e est de mesurer en continu la quantit√© de courant produite par les panneaux solaires. La deuxi√®me pince est optionnelle, dans mon cas elle est raccord√©e √† la prise du garage pour pouvoir suivre la consommation relative √† la charge.\nCe compteur se branche sur le cable d‚Äôinjection de courant solaire (onduleur mono-phas√©). L‚Äôinstallation se fait de la m√™me mani√®re que pour le compteur tri-phas√©. Il faut bien faire attention √† prendre l‚Äôalimentation sur la m√™me phase que celle qui r√©ceptionne le courant solaire.\nLa pince √† induction mesure en continu le courant produit par l‚Äôonduleur\nEtre en phase M√™me si d‚Äôun point de vue tarifaire cela ne fait aucune diff√©rence, il est plus rationnel de brancher le chargeur 220V Tesla sur la m√™me phase que celle de l‚Äôonduleur, afin de v√©ritablement pouvoir utiliser directement le courant produit (sans aller-retour au r√©seau). Dans mon cas, la prise garage n‚Äô√©tait pas sur la m√™me phase que l‚Äôonduleur, j‚Äôai donc d√ª la changer.","title":"Compteur monophas√©"},{"location":"/automation.html","text":"","title":"Automatisation ¬∑"},{"location":"/automation.html#automatisation","text":"Les sources de donn√©es n√©cessaires pour l‚Äôoptimisation sont maintenant en place, il est temps de passer √† la configuration du comportement de charge d√©sir√© dans Home Assistant.","title":"Automatisation"},{"location":"/automation.html#visual-studio-code","text":"La premi√®re √©tape est d‚Äôinstaller un √©diteur. Se rendre sur Add-on Store et installer ‚ÄúStudio Code Server‚Äù.\nRed√©marrer si n√©cessaire. Un onglet Studio Code Server est maintenant disponible dans le menu √† gauche et permet de naviguer entre les diff√©rents fichiers. La configuration principale se trouve dans configuration.yaml - qui lui-m√™me inclus d‚Äôautres fichiers p√©riph√©riques.","title":"Visual Studio Code"},{"location":"/automation.html#senseurs","text":"Il s‚Äôagit en premier lieu de d√©finir des ‚Äúsenseurs‚Äù qui nous permettront de prendre des d√©cisions.\nAjouter et modifier le code suivant dans configuration.yaml\nsensor:\n  - platform: template\n    sensors:\n      total_power_usage:\n          value_template:\n            \"{{ ((states.sensor.shellyem3_e8db84d72857_channel_a_power.state | float) +\n              (states.sensor.shellyem3_e8db84d72857_channel_b_power.state | float) +\n              states.sensor.shellyem3_e8db84d72857_channel_c_power.state | float)  | round(1) }}\"\n          friendly_name: \"Total power usage\"\n          unit_of_measurement: \"W\"\n          device_class: \"power\"\n          unique_id: \"0e564a2b1013f7e3a77f74038077128c\"\n      \n      ferrite_target_amps:\n        friendly_name: \"Ferrite amperage cible (instantane)\"\n        unit_of_measurement: \"A\"\n        icon_template: \"mdi:current-ac\"\n        value_template: \"{{ max((states('sensor.total_power_usage')|float - states('sensor.shellyem_98cdac1fb962_channel_2_power')|float) / -220, 0) }}\"\n        unique_id: \"0e564a2b1013f7e3a77f74038077128f\"\n        device_class: \"current\"\n\n      ferrite_id:\n        friendly_name: \"Ferrite API ID\"\n        value_template: \"{{ state_attr('binary_sensor.ferrite_online_sensor', 'id') }}\"\n        unique_id: \"0e564a2b1013f7e3a77f74038077128g\"\n\n  - platform: filter\n    name: \"Ferrite target amps (filtered)\"\n    entity_id: sensor.ferrite_target_amps\n    filters:\n      - filter: time_simple_moving_average\n        window_size: \"00:06\"\n        precision: 0\nWarning Attention, les espaces sont significatifs en YAML, il faut toujours s‚Äôassurer du bon alignement des blocs.","title":"Senseurs"},{"location":"/automation.html#total-power-usage","text":"Cette valeur calcul√©e est la consommation totale instantan√©e. Remplacer les identifiants des Shelly par les bons, par exemple shellyem3_e8db84d72857_channel_a_power comporte l‚Äôidentifiant de mon Shelly 3EM personnel et ne fonctionnera pas directement. A noter que ces valeurs deviennent n√©gatives en cas de retour dans le r√©seau.","title":"total_power_usage"},{"location":"/automation.html#ferrite-target-amps","text":"Cette valeur est le calcul continu de l‚Äôamp√©rage d√©sir√©, en fonction de la valeur pr√©c√©dente et de l‚Äôinjection solaire. Dans cette d√©finition √©galement, remplacer ferrite par le nom de votre Tesla et l‚Äôidentifiant shellyem_98cdac1fb962_channel_2_power par le Shelly EM qui mesure la production solaire dans votre configuration.","title":"ferrite_target_amps"},{"location":"/automation.html#ferrite-id","text":"Cette valeur est n√©cessaire pour envoyer la commande de r√©glage de l‚Äôamp√©rage et est inf√©r√©e d‚Äôun capteur pr√©sent avec l‚Äôint√©gration Tesla dont l‚Äôidentifiant comporte le nom de la voiture. Adapter l‚Äôidentifiant du senseur et la r√©f√©rence √† ferrite_online_sensor au nom de votre Tesla.","title":"ferrite_id"},{"location":"/automation.html#ferrite-target-amps-filtered","text":"Cette valeur est le r√©sultat d‚Äôune moyenne glissante d‚Äôune dur√©e de 6 minutes sur la valeur d‚Äôamp√©rage instantan√©e. Cela permet de lisser les variations, qui peuvent √™tre bien s√ªr importantes suivant l‚Äô√©tat du ciel et surtout la consommation domestique.\nSe rendre ensuite sur Configuration -> Server Control et cliquer sur le bouton Check Configuration pour v√©rifier la syntaxe. Si la configuration est correcte, il reste √† la recharger, soit en red√©marrant compl√®tement, soit en cliquant sur les boutons correspondants. Dans ce cas, il s‚Äôagit de Template Entities et Filter Entities. Les nouvelles entit√©s devraient maintenant appara√Ætre dans Configuration -> Entities.","title":"ferrite_target_amps_filtered"},{"location":"/automation.html#macros","text":"Tout est maintenant en place pour d√©finir les comportements d‚Äôoptimisation. Ceci peut se faire visuellement dans Configuration -> Automation mais la configuration est dans tous les cas stock√©e dans le fichier automations.yaml","title":"Macros"},{"location":"/automation.html#charge-en-heures-de-plein-tarif","text":"Pour d√©finir ce comportement, nous faisons √† un script qui d√©crit l‚Äôallumage de la charge. Ajouter et modifier le bloc suivant √† automations.yaml\n- id: '1629898634868'\n  alias: Charge Ferrite during peak hours with excess energy\n  description: ''\n  trigger:\n    - platform: time_pattern\n      minutes: /3\n  condition:\n    - condition: time\n      after: 06:00:00\n      before: '22:00:00'\n      weekday:\n        - mon\n        - tue\n        - wed\n        - thu\n        - fri\n    - condition: numeric_state\n      entity_id: sensor.ferrite_target_amps\n      above: '0'\n    - condition: device\n      device_id: a0123921d8920a36c1d23f33c287dc83\n      domain: device_tracker\n      entity_id: device_tracker.ferrite_location_tracker\n      type: is_home\n  action:\n    - type: turn_on\n      device_id: a0123921d8920a36c1d23f33c287dc83\n      entity_id: switch.ferrite_charger_switch\n      domain: switch\n    - service: tesla_custom.api\n      data:\n        command: CHARGING_AMPS\n        parameters:\n          path_vars:\n            vehicle_id: '{{ states(''sensor.ferrite_id'') }}'\n          charging_amps: '{{ states(''sensor.ferrite_target_amps_filtered'') }}'\n  mode: single\nIl est aussi possible de le reproduire dans l‚Äô√©diteur visuel, voici √† quoi cela ressemble:\nWarning Remplacer toutes les mentions de ferrite et le device_id par le nom et identifiants de votre propre Tesla, sinon cela ne fonctionnera pas. Se r√©f√©rer √† l‚Äôint√©gration Tesla pour trouver les identifiants dans votre propre installation. Il est aussi possible de reproduire la macro avec l‚Äô√©diteur visuel pour que les valeurs correctes soient automatiquement utilis√©es.","title":"Charge en heures de plein tarif"},{"location":"/automation.html#trigger","text":"Ce bloc indique que la macro doit s‚Äôexecuter toutes les trois minutes (ceci peut √™tre modifi√©)\ntrigger:\n    - platform: time_pattern\n      minutes: /3","title":"Trigger"},{"location":"/automation.html#horaire","text":"Ce bloc d√©finit l‚Äôhoraire du plein tarif, √† adapter suivant le cas\n- condition: time\n      after: 06:00:00\n      before: '22:00:00'\n      weekday:\n        - mon\n        - tue\n        - wed\n        - thu\n        - fri","title":"Horaire"},{"location":"/automation.html#arr√™t-de-la-charge-en-heures-pleines","text":"Cette macro est la duale de la pr√©c√©dente et permet de couper la charge quand il n‚Äôy a plus assez de courant exc√©dentaire:\n- id: '1629899004694'\n  alias: Stop charging Ferrite during peak hours when no excess energy\n  description: ''\n  trigger:\n  - platform: time_pattern\n    minutes: /3\n  condition:\n  - condition: device\n    device_id: a0123921d8920a36c1d23f33c287dc83\n    domain: device_tracker\n    entity_id: device_tracker.ferrite_location_tracker\n    type: is_home\n  - condition: time\n    after: 06:00:00\n    before: '22:00:00'\n    weekday:\n    - mon\n    - tue\n    - wed\n    - thu\n    - fri\n  - condition: numeric_state\n    entity_id: sensor.ferrite_target_amps\n    below: '1'\n  - condition: state\n    entity_id: binary_sensor.ferrite_charger_sensor\n    state: Charging\n    attribute: charging_state\n  action:\n  - type: turn_off\n    device_id: a0123921d8920a36c1d23f33c287dc83\n    entity_id: switch.ferrite_charger_switch\n    domain: switch\n  mode: single","title":"Arr√™t de la charge en heures pleines"},{"location":"/automation.html#charge-en-heures-creuses","text":"Les deux macros suivantes d√©finissent le d√©marrage de la charge d√®s que le tarif est bas, ce qui est mon cas de 22h √† 6h ainsi que le week-end:\n- id: '1629899895920'\n  alias: Charge Ferrite off-hours\n  description: ''\n  trigger:\n  - platform: time_pattern\n    minutes: /5\n  condition:\n  - condition: device\n    device_id: a0123921d8920a36c1d23f33c287dc83\n    domain: device_tracker\n    entity_id: device_tracker.ferrite_location_tracker\n    type: is_home\n  - condition: or\n    conditions:\n    - condition: time\n      after: '22:00:00'\n      before: 06:00:00\n      weekday:\n      - mon\n      - tue\n      - wed\n      - thu\n      - fri\n    - condition: time\n      after: 00:00:00\n      before: '23:59:59'\n      weekday:\n      - sat\n      - sun\n  action:\n  - type: turn_on\n    device_id: a0123921d8920a36c1d23f33c287dc83\n    entity_id: switch.ferrite_charger_switch\n    domain: switch\n  - service: tesla_custom.api\n    data:\n      command: CHARGING_AMPS\n      parameters:\n        path_vars:\n          vehicle_id: '{{ states(''sensor.ferrite_id'') }}'\n        charging_amps: '10'\n  mode: single\n- id: '1629899972387'\n  alias: Stop charging Ferrite after off-hours\n  description: ''\n  trigger:\n  - platform: time\n    at: 06:00\n  condition:\n  - condition: device\n    device_id: a0123921d8920a36c1d23f33c287dc83\n    domain: device_tracker\n    entity_id: device_tracker.ferrite_location_tracker\n    type: is_home\n  - condition: state\n    entity_id: binary_sensor.ferrite_charger_sensor\n    state: Charging\n    attribute: charging_state\n  - condition: time\n    weekday:\n    - mon\n    - tue\n    - wed\n    - thu\n    - fri\n    after: 00:00\n    before: '23:59:59'\n  action:\n  - type: turn_off\n    device_id: a0123921d8920a36c1d23f33c287dc83\n    entity_id: switch.ferrite_charger_switch\n    domain: switch\n  mode: single","title":"Charge en heures creuses"},{"location":"/dashboard.html","text":"","title":"Tableau de bord ¬∑"},{"location":"/dashboard.html#tableau-de-bord","text":"Voici un exemple de tableau de bord simple pour activer/d√©sactiver l‚Äôautomatisation, le ‚Äúmax range‚Äù et suivre l‚Äô√©volution de la charge. Ce tableau de bord fonctionne aussi sur l‚Äôapp.","title":"Tableau de bord"},{"location":"/dashboard.html#marche-√†-suivre","text":"Pour rajouter un onglet sp√©cialis√© dans le menu √† gauche avec ce tableau de bord, se rendre dans Configuration -> Lovelace Dashboards. Cliquer sur le bouton Add Dashboard en bas √† droite et entrer un nom, par exemple ‚ÄúTesla energy management‚Äù. Ouvrir le dashboard et choisir Edit Dashboard dans le menu en haut √† droite (les trois points) Dans le dialogue, cocher Start with an empty dashboard et choisir Take control Cliquer √† nouveau dans le menu en haut √† droite et choisir Raw configuration editor Coller et adapter la configuration suivante:\ntitle: Tesla energy management\nviews:\n  - path: default_view\n    title: Home\n    cards:\n      - type: glance\n        entities:\n          - entity: binary_sensor.ferrite_online_sensor\n      - type: gauge\n        entity: sensor.ferrite_battery_sensor\n        min: 0\n        max: 100\n      - type: button\n        tap_action:\n          action: toggle\n        entity: switch.ferrite_charger_switch\n        show_state: true\n      - type: history-graph\n        entities:\n          - entity: sensor.ferrite_charging_rate_sensor\n        hours_to_show: 24\n        refresh_interval: 0\n      - type: gauge\n        entity: sensor.ferrite_range_sensor\n        min: 0\n        max: 430\n      - type: entities\n        entities:\n          - entity: automation.charge_ferrite_off_hours\n          - entity: automation.stop_charging_ferrite_after_off_hours\n          - entity: automation.charge_ferrite_when_solar_production_above_threshold\n          - entity: automation.stop_charging_ferrite_when_solar_production_too_low\n        title: Automation\n      - type: map\n        entities:\n          - device_tracker.ferrite_location_tracker\n        title: Ferrite location\n        dark_mode: true\n      - type: history-graph\n        entities:\n          - entity: sensor.ferrite_target_amps\n          - entity: sensor.ferrite_target_amps_filtered\n          - entity: sensor.prise_garage_current\n        refresh_interval: 0\n        title: Amps\n        hours_to_show: 1\n      - type: button\n        tap_action:\n          action: toggle\n        entity: switch.ferrite_maxrange_switch\n        show_state: true","title":"Marche √† suivre"},{"location":"/about.html","text":"","title":"A propos de ce guide ¬∑"},{"location":"/about.html#a-propos-de-ce-guide","text":"Ce guide a √©t√© √©crit dans l‚Äôobjectif de rendre accessible au plus grand nombre l‚Äôoptimisation de la charge DYI avec v√©hicules Tesla.","title":"A propos de ce guide"},{"location":"/about.html#questions-r√©ponses","text":"Rejoignez-nous sur Discord:","title":"Questions-r√©ponses"},{"location":"/about.html#contributions","text":"Rejoignez-nous sur GitHub","title":"Contributions"},{"location":"/about.html#license","text":"Le copyright sur l‚Äôint√©gralit√© du site est reserv√© aux contributeurs de https://github.com/tesla-optimizer\nThis work is licensed under CC BY 4.0","title":"License"}]}