<!DOCTYPE html>
<html lang="fr" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Guide de montage d'un système d'optimisation de charge en continu pour véhicules Tesla">
<meta property="og:title" content="Tesla optimizer">
<meta property="og:description" content="Guide de montage d'un système d'optimisation de charge en continu pour véhicules Tesla">
<meta property="og:image" content="https://tesla-optimizer.github.io/assets/open-graph-logo.png">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Guide de montage d'un système d'optimisation de charge en continu pour véhicules Tesla">
<link rel="shortcut icon" href="assets/favicon.png">
<title>Automatisation · </title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
<meta name="theme-color" content="#7cb342" />
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Overpass:300,400,400i,700|Overpass+Mono">
<style>
body,input{font-family:"Overpass","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Overpass Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="light-green"
data-md-color-accent="light-green"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="" class="md-header-nav__button md-logo">
<img src="assets/logo-symbol-only.svg" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
</span>
<span class="md-header-nav__topic">
Automatisation
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tesla-optimizer/tesla-optimizer-tutorial"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tesla-optimizer/tesla-optimizer-tutorial
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="assets/logo-symbol-only.svg" width="24" height="24">
</a>
<a href="index.html" title="">
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tesla-optimizer/tesla-optimizer-tutorial"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tesla-optimizer/tesla-optimizer-tutorial
</div>
</a>

</div>
<ul>
  <li><a href="introduction.html" class="page">Introduction</a></li>
  <li><a href="materiel.html" class="page">Matériel</a></li>
  <li><a href="ha.html" class="page">Installation de Home-Assistant</a></li>
  <li><a href="tesla-ha.html" class="page">Tesla custom integration</a></li>
  <li><a href="compteurs.html" class="page">Compteurs électriques Wifi</a></li>
  <li><a href="automation.html" class="active page">Automatisation</a></li>
  <li><a href="dashboard.html" class="page">Tableau de bord</a></li>
  <li><a href="about.html" class="page">A propos de ce guide</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="automation.html#automatisation" class="header">Automatisation</a>
  <ul>
    <li><a href="automation.html#visual-studio-code" class="header">Visual Studio Code</a></li>
    <li><a href="automation.html#senseurs" class="header">Senseurs</a></li>
    <li><a href="automation.html#macros" class="header">Macros</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.3.2
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="automation.html#automatisation" class="header">Automatisation</a>
  <ul>
    <li><a href="automation.html#visual-studio-code" class="header">Visual Studio Code</a></li>
    <li><a href="automation.html#senseurs" class="header">Senseurs</a></li>
    <li><a href="automation.html#macros" class="header">Macros</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#automatisation" name="automatisation" class="anchor"><span class="anchor-link"></span></a>Automatisation</h1>
<p>Les sources de données nécessaires pour l&rsquo;optimisation sont maintenant en place, il est temps de passer à la configuration du comportement de charge désiré dans Home Assistant. </p>
<h2><a href="#visual-studio-code" name="visual-studio-code" class="anchor"><span class="anchor-link"></span></a>Visual Studio Code</h2>
<p>La première étape est d&rsquo;installer un éditeur. Se rendre sur <em><a href="http://homeassistant.local:8123/hassio/store">Add-on Store</a></em> et installer &ldquo;Studio Code Server&rdquo;.</p>
<p><img src="assets/vs-code.png" alt="vs-code" /></p>
<p>Redémarrer si nécessaire. Un onglet <em>Studio Code Server</em> est maintenant disponible dans le menu à gauche et permet de naviguer entre les différents fichiers. La configuration principale se trouve dans <code>configuration.yaml</code> - qui lui-même inclus d&rsquo;autres fichiers périphériques.</p>
<h2><a href="#senseurs" name="senseurs" class="anchor"><span class="anchor-link"></span></a>Senseurs</h2>
<p>Il s&rsquo;agit en premier lieu de définir des &ldquo;senseurs&rdquo; qui nous permettront de prendre des décisions. </p>
<p>Ajouter et modifier le code suivant dans <code>configuration.yaml</code></p>
<pre class="prettyprint"><code class="language-yaml">sensor:
  - platform: template
    sensors:
      total_power_usage:
          value_template:
            &quot;{{ ((states.sensor.shellyem3_e8db84d72857_channel_a_power.state | float) +
              (states.sensor.shellyem3_e8db84d72857_channel_b_power.state | float) +
              states.sensor.shellyem3_e8db84d72857_channel_c_power.state | float)  | round(1) }}&quot;
          friendly_name: &quot;Total power usage&quot;
          unit_of_measurement: &quot;W&quot;
          device_class: &quot;power&quot;
          unique_id: &quot;0e564a2b1013f7e3a77f74038077128c&quot;
      
      ferrite_target_amps:
        friendly_name: &quot;Ferrite amperage cible (instantane)&quot;
        unit_of_measurement: &quot;A&quot;
        icon_template: &quot;mdi:current-ac&quot;
        value_template: &quot;{{ max((states(&#39;sensor.total_power_usage&#39;)|float - states(&#39;sensor.shellyem_98cdac1fb962_channel_2_power&#39;)|float) / -220, 0) }}&quot;
        unique_id: &quot;0e564a2b1013f7e3a77f74038077128f&quot;
        device_class: &quot;current&quot;

      ferrite_id:
        friendly_name: &quot;Ferrite API ID&quot;
        value_template: &quot;{{ state_attr(&#39;binary_sensor.ferrite_online_sensor&#39;, &#39;id&#39;) }}&quot;
        unique_id: &quot;0e564a2b1013f7e3a77f74038077128g&quot;

  - platform: filter
    name: &quot;Ferrite target amps (filtered)&quot;
    entity_id: sensor.ferrite_target_amps
    filters:
      - filter: time_simple_moving_average
        window_size: &quot;00:06&quot;
        precision: 0
</code></pre><div class="callout warning "><div class="callout-title">Warning</div>
<p>Attention, les espaces sont significatifs en YAML, il faut toujours s&rsquo;assurer du bon alignement des blocs.</p></div>
<h3><a href="#total-power-usage" name="total-power-usage" class="anchor"><span class="anchor-link"></span></a><code>total_power_usage</code></h3>
<p>Cette valeur calculée est la consommation totale instantanée. Remplacer les identifiants des Shelly par les bons, par exemple <code>shellyem3_e8db84d72857_channel_a_power</code> comporte l&rsquo;identifiant de mon Shelly 3EM personnel et ne fonctionnera pas directement. A noter que ces valeurs deviennent négatives en cas de retour dans le réseau.</p>
<h3><a href="#ferrite-target-amps" name="ferrite-target-amps" class="anchor"><span class="anchor-link"></span></a><code>ferrite_target_amps</code></h3>
<p>Cette valeur est le calcul continu de l&rsquo;ampérage désiré, en fonction de la valeur précédente et de l&rsquo;injection solaire. Dans cette définition également, remplacer <code>ferrite</code> par le nom de votre Tesla et l&rsquo;identifiant <code>shellyem_98cdac1fb962_channel_2_power</code> par le Shelly EM qui mesure la production solaire dans votre configuration. </p>
<h3><a href="#ferrite-id" name="ferrite-id" class="anchor"><span class="anchor-link"></span></a><code>ferrite_id</code></h3>
<p>Cette valeur est nécessaire pour envoyer la commande de réglage de l&rsquo;ampérage et est inférée d&rsquo;un capteur présent avec l&rsquo;intégration Tesla dont l&rsquo;identifiant comporte le nom de la voiture. Adapter l&rsquo;identifiant du senseur et la référence à <code>ferrite_online_sensor</code> au nom de votre Tesla.</p>
<h3><a href="#ferrite-target-amps-filtered" name="ferrite-target-amps-filtered" class="anchor"><span class="anchor-link"></span></a><code>ferrite_target_amps_filtered</code></h3>
<p>Cette valeur est le résultat d&rsquo;une <a href="https://fr.wikipedia.org/wiki/Moyenne_mobile">moyenne glissante</a> d&rsquo;une durée de 6 minutes sur la valeur d&rsquo;ampérage instantanée. Cela permet de lisser les variations, qui peuvent être bien sûr importantes suivant l&rsquo;état du ciel et surtout la consommation domestique. </p>
<p>Se rendre ensuite sur <em><a href="http://homeassistant.local:8123/config/server_control">Configuration -&gt; Server Control</a></em> et cliquer sur le bouton <em>Check Configuration</em> pour vérifier la syntaxe. Si la configuration est correcte, il reste à la recharger, soit en redémarrant complètement, soit en cliquant sur les boutons correspondants. Dans ce cas, il s&rsquo;agit de <em>Template Entities</em> et <em>Filter Entities</em>. Les nouvelles entités devraient maintenant apparaître dans <em><a href="http://homeassistant.local:8123/config/entities">Configuration -&gt; Entities</a></em>.</p>
<h2><a href="#macros" name="macros" class="anchor"><span class="anchor-link"></span></a>Macros</h2>
<p>Tout est maintenant en place pour définir les comportements d&rsquo;optimisation. Ceci peut se faire visuellement dans <em><a href="http://homeassistant.local:8123/config/automation/dashboard">Configuration -&gt; Automation</a></em> mais la configuration est dans tous les cas stockée dans le fichier <code>automations.yaml</code></p>
<h3><a href="#charge-en-heures-de-plein-tarif" name="charge-en-heures-de-plein-tarif" class="anchor"><span class="anchor-link"></span></a>Charge en heures de plein tarif</h3>
<p>Pour définir ce comportement, nous faisons à un script qui décrit l&rsquo;allumage de la charge. Ajouter et modifier le bloc suivant à <code>automations.yaml</code></p>
<pre class="prettyprint"><code class="language-yaml">- id: &#39;1629898634868&#39;
  alias: Charge Ferrite during peak hours with excess energy
  description: &#39;&#39;
  trigger:
    - platform: time_pattern
      minutes: /3
  condition:
    - condition: time
      after: 06:00:00
      before: &#39;22:00:00&#39;
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: numeric_state
      entity_id: sensor.ferrite_target_amps
      above: &#39;0&#39;
    - condition: device
      device_id: a0123921d8920a36c1d23f33c287dc83
      domain: device_tracker
      entity_id: device_tracker.ferrite_location_tracker
      type: is_home
  action:
    - type: turn_on
      device_id: a0123921d8920a36c1d23f33c287dc83
      entity_id: switch.ferrite_charger_switch
      domain: switch
    - service: tesla_custom.api
      data:
        command: CHARGING_AMPS
        parameters:
          path_vars:
            vehicle_id: &#39;{{ states(&#39;&#39;sensor.ferrite_id&#39;&#39;) }}&#39;
          charging_amps: &#39;{{ states(&#39;&#39;sensor.ferrite_target_amps_filtered&#39;&#39;) }}&#39;
  mode: single
</code></pre>
<p>Il est aussi possible de le reproduire dans l&rsquo;éditeur visuel, voici à quoi cela ressemble: <img src="assets/charge-automation-1.png" alt="charge-automation-1" /> <img src="assets/charge-automation-2.png" alt="charge-automation-2" /> <img src="assets/charge-automation-3.png" alt="charge-automation-3" /> <img src="assets/charge-automation-4.png" alt="charge-automation-4" /></p><div class="callout warning "><div class="callout-title">Warning</div>
<p>Remplacer toutes les mentions de <code>ferrite</code> et le <code>device_id</code> par le nom et identifiants de votre propre Tesla, sinon cela ne fonctionnera pas. Se référer à l&rsquo;intégration Tesla pour trouver les identifiants dans votre propre installation. Il est aussi possible de reproduire la macro avec l&rsquo;éditeur visuel pour que les valeurs correctes soient automatiquement utilisées.</p></div>
<h4><a href="#trigger" name="trigger" class="anchor"><span class="anchor-link"></span></a>Trigger</h4>
<p>Ce bloc indique que la macro doit s&rsquo;executer toutes les trois minutes (ceci peut être modifié)</p>
<pre class="prettyprint"><code class="language-yaml">  trigger:
    - platform: time_pattern
      minutes: /3
</code></pre>
<h4><a href="#horaire" name="horaire" class="anchor"><span class="anchor-link"></span></a>Horaire</h4>
<p>Ce bloc définit l&rsquo;horaire du plein tarif, à adapter suivant le cas</p>
<pre class="prettyprint"><code class="language-yaml">    - condition: time
      after: 06:00:00
      before: &#39;22:00:00&#39;
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
</code></pre>
<h3><a href="#arrêt-de-la-charge-en-heures-pleines" name="arrêt-de-la-charge-en-heures-pleines" class="anchor"><span class="anchor-link"></span></a>Arrêt de la charge en heures pleines</h3>
<p>Cette macro est la duale de la précédente et permet de couper la charge quand il n&rsquo;y a plus assez de courant excédentaire:</p>
<pre class="prettyprint"><code class="language-yaml">- id: &#39;1629899004694&#39;
  alias: Stop charging Ferrite during peak hours when no excess energy
  description: &#39;&#39;
  trigger:
  - platform: time_pattern
    minutes: /3
  condition:
  - condition: device
    device_id: a0123921d8920a36c1d23f33c287dc83
    domain: device_tracker
    entity_id: device_tracker.ferrite_location_tracker
    type: is_home
  - condition: time
    after: 06:00:00
    before: &#39;22:00:00&#39;
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: numeric_state
    entity_id: sensor.ferrite_target_amps
    below: &#39;1&#39;
  - condition: state
    entity_id: binary_sensor.ferrite_charger_sensor
    state: Charging
    attribute: charging_state
  action:
  - type: turn_off
    device_id: a0123921d8920a36c1d23f33c287dc83
    entity_id: switch.ferrite_charger_switch
    domain: switch
  mode: single
</code></pre>
<h3><a href="#charge-en-heures-creuses" name="charge-en-heures-creuses" class="anchor"><span class="anchor-link"></span></a>Charge en heures creuses</h3>
<p>Les deux macros suivantes définissent le démarrage de la charge dès que le tarif est bas, ce qui est mon cas de 22h à 6h ainsi que le week-end:</p>
<pre class="prettyprint"><code class="language-yaml">- id: &#39;1629899895920&#39;
  alias: Charge Ferrite off-hours
  description: &#39;&#39;
  trigger:
  - platform: time_pattern
    minutes: /5
  condition:
  - condition: device
    device_id: a0123921d8920a36c1d23f33c287dc83
    domain: device_tracker
    entity_id: device_tracker.ferrite_location_tracker
    type: is_home
  - condition: or
    conditions:
    - condition: time
      after: &#39;22:00:00&#39;
      before: 06:00:00
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: time
      after: 00:00:00
      before: &#39;23:59:59&#39;
      weekday:
      - sat
      - sun
  action:
  - type: turn_on
    device_id: a0123921d8920a36c1d23f33c287dc83
    entity_id: switch.ferrite_charger_switch
    domain: switch
  - service: tesla_custom.api
    data:
      command: CHARGING_AMPS
      parameters:
        path_vars:
          vehicle_id: &#39;{{ states(&#39;&#39;sensor.ferrite_id&#39;&#39;) }}&#39;
        charging_amps: &#39;10&#39;
  mode: single
- id: &#39;1629899972387&#39;
  alias: Stop charging Ferrite after off-hours
  description: &#39;&#39;
  trigger:
  - platform: time
    at: 06:00
  condition:
  - condition: device
    device_id: a0123921d8920a36c1d23f33c287dc83
    domain: device_tracker
    entity_id: device_tracker.ferrite_location_tracker
    type: is_home
  - condition: state
    entity_id: binary_sensor.ferrite_charger_sensor
    state: Charging
    attribute: charging_state
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    after: 00:00
    before: &#39;23:59:59&#39;
  action:
  - type: turn_off
    device_id: a0123921d8920a36c1d23f33c287dc83
    entity_id: switch.ferrite_charger_switch
    domain: switch
  mode: single
</code></pre>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.3.2
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="compteurs.html" title="Compteurs électriques Wifi" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Compteurs électriques Wifi
</span>
</div>
</a>
<a href="dashboard.html" title="Tableau de bord" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Tableau de bord
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Tesla-optimizer contributors
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/tesla-optimizer/tesla-optimizer-tutorial" class="md-footer-social__link fa fa-github"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","G-JPNJ7NZED4"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});if(document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>

</body>
</html>